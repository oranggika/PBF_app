<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Identitas Negara PBF Editable Shared</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap");
  </style>
</head>
<body
  class="bg-[#0046bb] min-h-screen flex flex-col items-center py-8 px-4"
>
  <h1
    class="text-white font-mono text-[28px] sm:text-[32px] md:text-[36px] font-extrabold mb-10 select-none"
    style="font-family: 'Roboto Mono', monospace"
  >
    IDENTITAS NEGARA PBF
  </h1>
  <div
    id="cards-container"
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 max-w-[1200px] w-full"
  >
    <!-- Cards will be generated by JS -->
  </div>

  <script>
    // Use Roboto Mono font family for editable text
    const fontFamily = "'Roboto Mono', monospace";

    // Number of cards to generate
    const cardCount = 15;

    // Default placeholder image URL
    const defaultImageURL =
      "https://placehold.co/120x80?text=FOTO+%22BISA+DI+ISI+COSTOM%22&font=roboto-mono&font-size=12&text-align=center&bg=ffffff&fg=4a4a4a";

    // Default signature image URL
    const defaultSignatureURL =
      "https://placehold.co/120x40?text=Tanda+tangan+pendiri+PBF&font=roboto-mono&font-size=10&text-align=center&bg=f3f3f3&fg=4a4a4a";

    // Key for localStorage to store shared data
    const STORAGE_KEY = "pbfCardsDataShared";

    // Load saved data from localStorage or create default data
    function loadData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          return JSON.parse(saved);
        } catch {
          // If corrupted, fallback to default
          return createDefaultData();
        }
      } else {
        return createDefaultData();
      }
    }

    // Create default data array for cards
    function createDefaultData() {
      const arr = [];
      for (let i = 0; i < cardCount; i++) {
        arr.push({
          imageURL: defaultImageURL,
          namaNegara: '"BISA DI ISI COSTOM"',
          namaMataUang: '"BISA DI ISI COSTOM"',
          namaPresiden: '"BISA DI ISI COSTOM"',
          merdekaPada: '"BISA DI ISI COSTOM"',
          signatureURL: defaultSignatureURL,
          signatureText: "Tanda tangan pendiri PBF",
        });
      }
      return arr;
    }

    // Save data to localStorage
    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Create a single card element
    function createCard(cardData, index, dataArray) {
      const card = document.createElement("div");
      card.className =
        "bg-white rounded-xl border-4 border-[#4a3c2a] p-4 flex flex-col items-center max-w-[220px] mx-auto";

      // Image container with file input overlay
      const imgContainer = document.createElement("div");
      imgContainer.className = "relative mb-4 w-[120px] h-[80px]";

      const img = document.createElement("img");
      img.src = cardData.imageURL;
      img.alt =
        'Photo box with text "FOTO \\"BISA DI ISI COSTOM\\"" placeholder or user image';
      img.className = "w-full h-full object-contain rounded-md cursor-pointer";
      imgContainer.appendChild(img);

      // Hidden file input for image upload
      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.accept = "image/*";
      fileInput.className =
        "absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer";
      fileInput.title = "Click to change photo";
      imgContainer.appendChild(fileInput);

      // On file select, update image and save
      fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (event) {
            img.src = event.target.result;
            cardData.imageURL = event.target.result;
            saveData(dataArray);
            // Broadcast change to other tabs
            localStorage.setItem("pbfCardsDataUpdate", Date.now());
          };
          reader.readAsDataURL(file);
        }
      });

      card.appendChild(imgContainer);

      // Text fields container
      const textContainer = document.createElement("div");
      textContainer.className =
        "w-full text-[9px] text-[#6b6b6b] font-mono leading-[1.1] mb-6";
      textContainer.style.fontFamily = fontFamily;

      // Helper to create editable line
      function createEditableLine(label, key) {
        const p = document.createElement("p");
        p.className = "mb-1";

        const spanLabel = document.createElement("span");
        spanLabel.className = "font-semibold text-black select-none";
        spanLabel.textContent = label;
        p.appendChild(spanLabel);

        const spanText = document.createElement("span");
        spanText.contentEditable = "true";
        spanText.spellcheck = false;
        spanText.className = "ml-1 outline-none";
        spanText.style.userSelect = "text";
        spanText.textContent = cardData[key];

        // On input, update data and save
        spanText.addEventListener("input", () => {
          cardData[key] = spanText.textContent;
          saveData(dataArray);
          // Broadcast change to other tabs
          localStorage.setItem("pbfCardsDataUpdate", Date.now());
        });

        p.appendChild(spanText);
        return p;
      }

      textContainer.appendChild(createEditableLine("NAMA NEGARA", "namaNegara"));
      textContainer.appendChild(createEditableLine("NAMA MATA UANG", "namaMataUang"));
      textContainer.appendChild(createEditableLine("NAMA PRESIDEN", "namaPresiden"));
      textContainer.appendChild(createEditableLine("MERDEKA PADA", "merdekaPada"));

      card.appendChild(textContainer);

      // Signature container
      const signatureContainer = document.createElement("div");
      signatureContainer.className = "w-full flex flex-col items-center";

      const signatureImg = document.createElement("img");
      signatureImg.src = cardData.signatureURL;
      signatureImg.alt =
        "Signature and line with text 'Tanda tangan pendiri PBF' in black on light gray background";
      signatureImg.className = "mb-1 max-w-[120px] h-auto object-contain rounded-sm";
      signatureContainer.appendChild(signatureImg);

      // Editable signature text
      const signatureText = document.createElement("div");
      signatureText.contentEditable = "true";
      signatureText.spellcheck = false;
      signatureText.className =
        "text-[9px] font-mono text-[#6b6b6b] select-text w-full text-center outline-none";
      signatureText.style.fontFamily = fontFamily;
      signatureText.textContent = cardData.signatureText;

      signatureText.addEventListener("input", () => {
        cardData.signatureText = signatureText.textContent;
        saveData(dataArray);
        // Broadcast change to other tabs
        localStorage.setItem("pbfCardsDataUpdate", Date.now());
      });

      signatureContainer.appendChild(signatureText);

      card.appendChild(signatureContainer);

      return card;
    }

    // Main function to render all cards
    function renderCards() {
      const container = document.getElementById("cards-container");
      container.innerHTML = "";
      const data = loadData();

      data.forEach((cardData, index) => {
        const card = createCard(cardData, index, data);
        container.appendChild(card);
      });
    }

    // Listen for storage events to sync data across tabs/windows
    window.addEventListener("storage", (event) => {
      if (event.key === "pbfCardsDataUpdate") {
        // Reload data and re-render cards
        renderCards();
      }
    });

    // Initial render
    renderCards();
  </script>
</body>
</html>